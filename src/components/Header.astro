---
import {
  SignedIn,
  SignedOut,
  UserButton,
  SignInButton,
} from "@clerk/astro/components";
---

<!-- Header Sticky -->
<header class="sticky top-0 z-50 backdrop-blur-sm shadow-sm">
  <div
    class="grid grid-cols-3 items-center py-4 w-full xl:w-[1120px] mx-auto px-4"
  >
    <!-- Logo -->
    <div class="flex items-center">
      <a href="/">
        <img src="/public/logo.webp" alt="Agua Máxima" class="w-10 h-10" />
      </a>
    </div>

    <!-- Desktop Navigation - Centered -->
    <nav class="hidden md:flex flex-row gap-x-8 justify-center opacity-90">
      <a href="/" class="hover:text-[#0288c7] transition-colors duration-300"
        >Inicio</a
      >
      <a
        href="/nosotros"
        class="hover:text-[#0288c7] transition-colors duration-300">Nosotros</a
      >
      <a
        href="/productos"
        class="hover:text-[#0288c7] transition-colors duration-300">Productos</a
      >
    </nav>

    <!-- Desktop CTA Buttons -->
    <div class="hidden md:flex items-center gap-3 justify-end">
      <!-- User Button -->
      <SignedOut>
        <SignInButton asChild mode="modal">
          <button
            class="bg-[#0288c7] text-white px-4 py-2 rounded-lg font-semibold hover:bg-[#083049] transition-colors duration-300 cursor-pointer"
          >
            Iniciar Sesión
          </button>
        </SignInButton>
      </SignedOut>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <!-- Solicitar Button -->
      <a
        href="/solicitar"
        class="bg-[#0288c7] text-white px-4 py-2 rounded-lg font-semibold hover:bg-[#083049] transition-colors duration-300"
      >
        Solicitar
      </a>
    </div>

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-button"
      class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-[#0288c7] hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#0288c7] transition-colors duration-300"
      aria-expanded="false"
    >
      <span class="sr-only">Abrir menú principal</span>
      <!-- Icon when menu is closed -->
      <svg
        id="menu-icon-closed"
        class="block h-6 w-6"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <!-- Icon when menu is open -->
      <svg
        id="menu-icon-open"
        class="hidden h-6 w-6"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Mobile Navigation Menu -->
  <div id="mobile-menu" class="md:hidden hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 bg-white border-t border-gray-100">
      <a
        href="/"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-[#0288c7] hover:bg-gray-50 transition-colors duration-300"
      >
        Inicio
      </a>
      <a
        href="/nosotros"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-[#0288c7] hover:bg-gray-50 transition-colors duration-300"
      >
        Nosotros
      </a>
      <a
        href="/productos"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-[#0288c7] hover:bg-gray-50 transition-colors duration-300"
      >
        Productos
      </a>
      <!-- Mobile Solicitar Button -->
      <div class="pt-2 pb-2 border-t border-gray-200">
        <a
          href="/solicitar"
          class="block mx-3 px-4 py-2 bg-[#0288c7] text-white text-center rounded-lg font-semibold hover:bg-[#083049] transition-colors duration-300"
        >
          Solicitar
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Función para inicializar el menú móvil
  function initializeMobileMenu() {
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIconClosed = document.getElementById("menu-icon-closed");
    const menuIconOpen = document.getElementById("menu-icon-open");

    if (mobileMenuButton && mobileMenu && menuIconClosed && menuIconOpen) {
      // Remover event listeners existentes para evitar duplicados
      const newButton = mobileMenuButton.cloneNode(true);
      mobileMenuButton.parentNode?.replaceChild(newButton, mobileMenuButton);

      // Obtener las nuevas referencias después del clone
      const newMobileMenuButton = document.getElementById("mobile-menu-button");
      const newMobileMenu = document.getElementById("mobile-menu");
      const newMenuIconClosed = document.getElementById("menu-icon-closed");
      const newMenuIconOpen = document.getElementById("menu-icon-open");

      if (
        newMobileMenuButton &&
        newMobileMenu &&
        newMenuIconClosed &&
        newMenuIconOpen
      ) {
        newMobileMenuButton.addEventListener("click", function () {
          const isExpanded =
            newMobileMenuButton.getAttribute("aria-expanded") === "true";

          // Toggle menu visibility
          newMobileMenu.classList.toggle("hidden");

          // Toggle icons
          newMenuIconClosed.classList.toggle("hidden");
          newMenuIconClosed.classList.toggle("block");
          newMenuIconOpen.classList.toggle("hidden");
          newMenuIconOpen.classList.toggle("block");

          // Update aria-expanded
          newMobileMenuButton.setAttribute(
            "aria-expanded",
            (!isExpanded).toString()
          );
        });

        // Close menu when clicking on links
        const mobileLinks = newMobileMenu.querySelectorAll("a");
        mobileLinks.forEach((link) => {
          link.addEventListener("click", function () {
            newMobileMenu.classList.add("hidden");
            newMenuIconClosed.classList.remove("hidden");
            newMenuIconClosed.classList.add("block");
            newMenuIconOpen.classList.add("hidden");
            newMenuIconOpen.classList.remove("block");
            newMobileMenuButton.setAttribute("aria-expanded", "false");
          });
        });

        // Close menu when clicking outside
        const handleOutsideClick = function (event: Event) {
          const target = event.target as Node;
          if (
            !newMobileMenuButton.contains(target) &&
            !newMobileMenu.contains(target)
          ) {
            newMobileMenu.classList.add("hidden");
            newMenuIconClosed.classList.remove("hidden");
            newMenuIconClosed.classList.add("block");
            newMenuIconOpen.classList.add("hidden");
            newMenuIconOpen.classList.remove("block");
            newMobileMenuButton.setAttribute("aria-expanded", "false");
          }
        };

        // Remover event listener anterior si existe
        document.removeEventListener("click", handleOutsideClick);
        document.addEventListener("click", handleOutsideClick);
      }
    }
  }

  // Inicializar en la carga inicial de la página
  document.addEventListener("DOMContentLoaded", initializeMobileMenu);

  // Inicializar en cada navegación de página (para Astro Transitions)
  document.addEventListener("astro:page-load", initializeMobileMenu);
</script>
